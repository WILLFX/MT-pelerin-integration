<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Buy xDai via Ramp</title>
</head>
<body>
  <h1>Buy xDai (Gnosis Chain)</h1>

  <button id="connectBtn">Connect MetaMask</button>

  <div id="formSection" style="display:none;">
    <p>1. Choose your currency:</p>
    <select id="currencySelect">
      <option value="USD">USD â€“ US Dollar</option>
      <option value="EUR">EUR â€“ Euro</option>
      <option value="GBP">GBP â€“ British Pound</option>
      <option value="CAD">CAD â€“ Canadian Dollar</option>
      <option value="AUD">AUD â€“ Australian Dollar</option>
      <option value="NGN">NGN â€“ Nigerian Naira</option>
      <option value="KES">KES â€“ Kenyan Shilling</option>
      <option value="ZAR">ZAR â€“ South African Rand</option>
      <option value="INR">INR â€“ Indian Rupee</option>
      <option value="BRL">BRL â€“ Brazilian Real</option>
      <option value="MXN">MXN â€“ Mexican Peso</option>
      <option value="PHP">PHP â€“ Philippine Peso</option>
      <option value="HUF">HUF â€“ Hungarian Forint</option>
      <option value="TRY">TRY â€“ Turkish Lira</option>
      <option value="PLN">PLN â€“ Polish ZÅ‚oty</option>
    </select>

    <p>2. Optional: Enter how much you want to spend</p>
    <input type="number" id="amountInput" placeholder="e.g. 25" />

    <p>3. Click below to continue with Ramp Network</p>
    <button id="buyXdaiBtn">Buy xDai with Card</button>
  </div>

  <p id="status">Not connected.</p>

  <script>
    let userAddress = null;
    let previousBalance = null;
    const gnosisChainId = '0x64';

    async function connectWallet() {
      if (!window.ethereum) {
        alert("Please install MetaMask");
        return;
      }

      try {
        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        userAddress = accounts[0];
        document.getElementById('status').innerText = `Connected: ${userAddress}`;

        const currentChain = await window.ethereum.request({ method: 'eth_chainId' });
        if (currentChain !== gnosisChainId) {
          await window.ethereum.request({
            method: 'wallet_switchEthereumChain',
            params: [{ chainId: gnosisChainId }]
          });
        }

        document.getElementById('formSection').style.display = 'block';
        startBalancePolling();
      } catch (err) {
        console.error(err);
        alert("Connection failed");
      }
    }

    async function getXDAIBalance() {
      const balanceHex = await window.ethereum.request({
        method: 'eth_getBalance',
        params: [userAddress, 'latest']
      });
      return parseFloat(parseInt(balanceHex, 16) / 1e18);
    }

    async function startBalancePolling() {
      previousBalance = await getXDAIBalance();
      console.log("Starting balance polling. Initial balance:", previousBalance);

      setInterval(async () => {
        const currentBalance = await getXDAIBalance();
        console.log("Balance check:", currentBalance);

        if (currentBalance > previousBalance) {
          document.getElementById('status').innerText = `ðŸŽ‰ xDai received! New balance: ${currentBalance.toFixed(4)}`;
        }

        previousBalance = currentBalance;
      }, 5000);
    }

    document.getElementById('connectBtn').addEventListener('click', connectWallet);

    document.getElementById('buyXdaiBtn').addEventListener('click', () => {
      const currency = document.getElementById('currencySelect').value;
      const amount = document.getElementById('amountInput').value;

      let rampURL = `https://app.ramp.network/?swapAsset=XDAI_XDAI&userAddress=${userAddress}`;

      if (currency) rampURL += `&fiatCurrency=${currency}`;
      if (amount) rampURL += `&fiatValue=${amount}`;

      window.open(rampURL, '_blank');
    });
  </script>
</body>
</html>






