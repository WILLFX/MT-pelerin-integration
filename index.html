<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Mt Pelerin Test Integration</title>
</head>
<body>
  <h1>Test Mt Pelerin Widget Integration</h1>

  <button id="connectBtn">Connect MetaMask</button>
  <button id="openWidgetBtn" disabled>Buy xDai (Open Widget)</button>

  <p id="status">Not connected.</p>

  <!-- Mt Pelerin widget loader -->
  <script src="https://widgets.mtpelerin.com/bridge-widget.js"></script>

  <script>
    const MTP_TEST_KEY = 'bec6626e-8913-497d-9835-6e6ae9edb144';
    const gnosisChainId = '0x64'; // Gnosis Chain

    let userAddress = null;
    let mtpWidget = null;

    async function connectWallet() {
      if (!window.ethereum) {
        alert("MetaMask not detected.");
        return;
      }

      try {
        const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
        userAddress = accounts[0];
        document.getElementById('status').innerText = `Connected: ${userAddress}`;

        const chainId = await ethereum.request({ method: 'eth_chainId' });
        if (chainId !== gnosisChainId) {
          await ethereum.request({
            method: 'wallet_switchEthereumChain',
            params: [{ chainId: gnosisChainId }]
          });
        }

        document.getElementById('openWidgetBtn').disabled = false;
      } catch (error) {
        console.error(error);
        alert("Failed to connect or switch network.");
      }
    }

    function openMtPelerinWidget() {
      const config = {
        apiKey: MTP_TEST_KEY,
        crypto: 'XDAI',
        fiat: 'USD',
        userAddress: userAddress
      };

      if (!mtpWidget) {
        mtpWidget = new MtPelerinBridgeWidget(config);
      } else {
        mtpWidget.config = config;
      }

      mtpWidget.open();
    }

    document.getElementById('connectBtn').addEventListener('click', connectWallet);
    document.getElementById('openWidgetBtn').addEventListener('click', openMtPelerinWidget);
  </script>
</body>
</html>






